let locations=[
    {
        name:"Badrinath",
        desc:"Journey from Dehradun to Badrinath: from Himalayan tranquility to the vibrant energy of India's capital.",
        time:"7",
        distance:"251",
        image:"../Images/top-section-2-img-3.avif",
    },
    {
        name:"Kedarnath",
        desc:"Experience the scenic journey from bustling Dehradun to the serene, tranquil hills of Kedarnath.",
        time:"7",
        distance:"324",
        image:"../Images/top-section-2-img-2.jpg",
    },
    {
        name:"Nainital",
        desc:"Travel from Dehradun to Nainital by car, enjoying coastal beauty and scenic Western Ghats along the way.",
        time:"6",
        distance:"493",
        image:"../Images/top-section-2-img-1.cms",
    },
    {
        name:"Gangotri",
        desc:"The journey from Dehradun to Gangotri offers stunning views of the Garhwal Himalayas and sacred landscapes.",
        time:"6",
        distance:"224",
        image:"../Images/top-section-2-img-4.jpg",
    },
    {
        name:"Yamunotri",
        desc:"The journey from Dehradun to Yamunotri offers a picturesque route through the scenic beauty of the Garhwal Himalayas.",
        time:"5",
        distance:"124",
        image:"../Images/top-section-2-img-5.webp",
    },
    {
        name:"Uttarkashi",
        desc:"Uttarkashi is a Hindu religious place for spiritual and adventurous tourism. Uttarkashi town is also called as Shivnagri.",
        time:"4",
        distance:"144",
        image:"../Images/top-section-2-img-6.jpg",
    },
    {
        name:"Rishikesh",
        desc:"Rishikesh is a city in India’s northern state of Uttarakhand, in the Himalayan foothills beside the Ganges River",
        time:"1",
        distance:"38",
        image:"../Images/top-section-2-img-7.avif",
    },
    {
        name:"Mussorie",
        desc:"Mussoorie is a hill station and a municipal board, in Dehradun city in the Dehradun district of the Indian state Uttarakhand",
        time:"2",
        distance:"40",
        image:"../Images/top-section-2-img-8.jpg",
    },
    {
        name:"Chamoli",
        desc:"Chamoli hosts a variety of destinations of pilgrim and tourist interest including Badrinath, Hemkund Sahib and Valley of Flowers.",
        time:"8",
        distance:"264",
        image:"../Images/top-section-2-img-9.webp",
    },
];

let cars=[
    {
        name:"Maruti Suzuki Celerio",
        category:"Business",
        desc:"The Maruti Suzuki Celerio is a compact hatchback known for its fuel efficiency and practical design, making it an ideal choice for urban commuting. It features a spacious interior, user-friendly technology, and the option of an AMT gearbox for added convenience.",
        price:"10",
        capacity:"5-seater",
        airbags:"Dual front airbags",
        features:"Suzuki Connect, ABS with EBD, Heartect platform",
        image:"../Images/celerio.webp",
    },
    {
        name:"Maruti Suzuki Wagon R",
        category:"Business",
        desc:"The Maruti Suzuki Wagon R is a popular tallboy hatchback offering a spacious and practical interior, making it a favorite among small families. Known for its reliability and fuel efficiency, it comes with a choice of peppy engines and advanced safety features.",
        price:"15",
        capacity:"5-seater",
        airbags:"Dual front airbags",
        features:"Suzuki Connect, ABS with EBD, Heartect platform",
        image:"../Images/wagonR.webp",
    },
    {
        name:"Toyota Innova Crysta",
        category:"SUV",
        desc:"The Toyota Innova Crysta is a premium MPV renowned for its robust build quality, spacious and luxurious interior, and powerful engine options. It offers a comfortable ride with advanced safety features and modern infotainment systems, making it a preferred choice for families and long-distance travelers.",
        price:"45",
        capacity:"7-seater or 8-seater options",
        airbags:"Dual front airbags (standard), up to 7 airbags available in higher variants",
        features:"Touchscreen infotainment system, automatic climate control, ABS with EBD, Vehicle Stability Control (VSC)",
        image:"../Images/crysta.webp",
    },
    {
        name:"Tata Tiago",
        category:"Business",
        desc:"The Tata Tiago is a stylish and compact hatchback that offers a blend of performance, fuel efficiency, and modern features. It comes with a well-designed interior, advanced safety options, and a user-friendly infotainment system, making it a popular choice for urban commuters.",
        price:"18",
        capacity:"5-seater",
        airbags:"Dual front airbags (standard)",
        features:"Harman infotainment system, ABS with EBD, Dual airbags",
        image:"../Images/tiago.webp",
    },
    {
        name:"Mahindra Marazzo",
        category:"SUV",
        desc:"The Mahindra Marazzo is a versatile MPV known for its spacious and comfortable cabin, making it ideal for family travel. It features a smooth ride, robust build quality, and a range of modern amenities, including advanced safety and infotainment systems.",
        price:"47",
        capacity:"7-seater or 8-seater options",
        airbags:"Dual front airbags (standard)",
        features:"Surround cool technology, Android Auto and Apple CarPlay, ABS with EBD, ISOFIX child seat mounts",
        image:"../Images/marazzo.webp",
    },
    {
        name:"Maruti Suzuki Ertiga",
        category:"SUV",
        desc:"The Maruti Suzuki Ertiga is a popular MPV that combines practicality with affordability, offering a spacious interior suitable for families. It features efficient engine options, modern infotainment, and safety features, providing a comfortable and reliable ride for urban and long-distance travel.",
        price:"42",
        capacity:"7-seater",
        airbags:"Dual front airbags (standard)",
        features:"SmartPlay infotainment system, Android Auto and Apple CarPlay support, ABS with EBD, ISOFIX child seat mounts",
        image:"../Images/ertiga.webp",
    },
    {
        name:"Honda Amaze",
        category:"Standard",
        desc:"The Honda Amaze is a compact sedan known for its stylish design, spacious interior, and excellent fuel efficiency. It offers a comfortable ride with advanced safety features and modern infotainment options, making it a practical choice for urban and highway driving.",
        price:"20",
        capacity:"5-seater",
        airbags:"Dual front airbags (standard)",
        features:"Multi-angle rearview camera, Honda LaneWatch, ABS with EBD",
        image:"../Images/amaze.webp",
    },
    {
        name:"Maruti Suzuki Ciaz",
        category:"Standard",
        desc:"The Maruti Suzuki Ciaz is a midsize sedan that combines elegant design with spacious interiors and excellent fuel efficiency. It features a comfortable ride, advanced safety systems, and modern infotainment options, making it a popular choice for both city and highway driving.",
        price:"23",
        capacity:"5-seater",
        airbags:"Dual front airbags (standard)",
        features:"SmartPlay infotainment system, Android Auto and Apple CarPlay support, ABS with EBD, ISOFIX child seat mounts",
        image:"../Images/ciaz.webp",
    },
    {
        name:"Maruti Suzuki Dzire",
        category:"Standard",
        desc:"The Maruti Suzuki Dzire is a compact sedan celebrated for its sleek design, fuel efficiency, and comfortable cabin. It offers a smooth ride, modern features, and advanced safety technologies, making it a top choice for urban commuters and small families alike.",
        price:"25",
        capacity:"5-seater",
        airbags:"Dual front airbags (standard)",
        features:"SmartPlay infotainment system, Android Auto and Apple CarPlay support, ABS with EBD, ISOFIX child seat mounts",
        image:"../Images/dzire.webp",
    },
    {
        name:"Hyundai AURA",
        category:"Standard",
        desc:"The Hyundai Aura is a stylish and compact sedan known for its modern design, comfortable interiors, and advanced features. Offering a smooth ride and fuel-efficient engines, it also boasts a range of safety technologies, making it an excellent choice for urban commuting and long-distance travel.",
        price:"28",
        capacity:"5-seater",
        airbags:"Dual front airbags (standard)",
        features:"Wireless phone charger, Arkamys premium sound system, ABS with EBD",
        image:"../Images/aura.webp",
    },
    {
        name:"Hyundai iMax N",
        category:"Van",
        desc:"The Hyundai iMax N is a high-performance van designed for both versatility and speed. With its spacious interior and potent engine, it combines practicality with exhilarating driving experiences, making it a standout choice for those seeking both utility and performance in a larger vehicle.",
        price:"100",
        capacity:"8-seater",
        airbags:"Dual front airbags (standard)",
        features:"Performance-oriented engine, Spacious cabin, Advanced safety features",
        image:"../Images/iMaxN.jpg",
    },
    {
        name:"Nissan Caravan 4WD",
        category:"MiniVan",
        desc:"The Nissan Caravan 4WD is a rugged and versatile van built for off-road adventures and challenging terrain. With its four-wheel-drive capability, spacious interior, and robust construction, it offers reliable performance and ample cargo space, making it ideal for outdoor enthusiasts and commercial use in various environments.",
        price:"80",
        capacity:"6-seater",
        airbags:"Dual front airbags (standard)",
        features:"",
        image:"../Images/caravan.png",
    },
    {
        name:"Volkswagen Camper",
        category:"Van",
        desc:"The Volkswagen Camper, also known as the VW Bus or Transporter, is an iconic camper van celebrated for its timeless design and practicality. Renowned for its versatility, it offers a comfortable living space with sleeping quarters, kitchen amenities, and ample storage, making it a beloved choice for road trips and outdoor adventures.",
        price:"108",
        capacity:"Varies based on model and layout (typically 4-5 people)",
        airbags:"Dependent on model and year",
        features:"Convertible living space, kitchen amenities, ample storage",
        image:"../Images/camper.jpg",
    },
    {
        name:"Force Traveller 3350 Van",
        category:"Van",
        desc:"The Force Traveller 3350 Van is a reliable and spacious commercial vehicle designed for passenger transportation. With its sturdy build, comfortable seating, and ample luggage space, it provides a comfortable and safe travel experience for both short and long journeys, making it a preferred choice for businesses, tour operators, and transportation services.",
        price:"98",
        capacity:"12 to 26-seater options",
        airbags:"Not typically equipped",
        features:"Spacious interior, customizable seating configurations, durable build for commercial use",
        image:"../Images/force.jpg",
    },
    {
        name:"Mercedes R63 AMG",
        category:"MiniVan",
        desc:"The Mercedes R63 AMG is a rare and high-performance luxury SUV that combines Mercedes-Benz's renowned comfort and refinement with AMG's performance prowess. Powered by a potent V8 engine, it offers exceptional acceleration and handling for an SUV of its size, making it a standout choice for those seeking a blend of luxury, practicality, and thrilling driving dynamics.",
        price:"86",
        capacity:"7-seater",
        airbags:"Front, side, and curtain airbags",
        features:"AMG-tuned V8 engine, luxurious interior, advanced safety systems",
        image:"../Images/amg.jpg",
    },
]

function displayData(data){
    let parentDiv=document.querySelector(".parent-cars");
    parentDiv.innerHTML="";

    data.forEach(car=>{

        const carDiv = document.createElement('div');
        carDiv.className='child-cars';

        carDiv.innerHTML = `
        <div class="single pointer">
            <img src="${car.image}" alt="">
        </div>
        <div>
            <h1>${car.name}</h1>
            <p><span>Category: </span>${car.category}</p>
            <h2>₹${car.price}/km</h2>
            <div class="btn">
                <button class="book-now pointer">BOOK NOW</button>
            </div>
        </div>
        `;

        carDiv.querySelector(".single").addEventListener("click", () => handleSingle(car));
        carDiv.querySelector(".book-now").addEventListener("click", () => handleBook(car));

        parentDiv.appendChild(carDiv);
    });
}
displayData(cars);

//search bar
document.getElementById('search').addEventListener('input', () => {
    const query = document.getElementById('search').value.toLowerCase();
    const filteredCars = cars.filter(car => car.name.toLowerCase().includes(query));
    displayData(filteredCars);
});

displayData(cars);

//Sort and filter
let price=document.getElementById("price");
price.addEventListener("change",sortData);

let category=document.getElementById("category");
category.addEventListener("change",sortData);

function sortData() {
    let arr=[...cars];

    if(category.value == "Business"){
        arr = arr.filter(car => car.category == category.value);
    }
    else if(category.value == "Standard"){
        arr = arr.filter(car => car.category == category.value);
    }
    else if(category.value == "SUV"){
        arr = arr.filter(car => car.category == category.value);
    }
    else if(category.value == "MiniVan"){
        arr = arr.filter(car => car.category == category.value);
    }
    else if(category.value == "Van"){
        arr = arr.filter(car => car.category == category.value);
    }

    if(price.value == "l2h"){
        arr.sort((a,b)=>a.price-b.price);
    }
    else if(price.value == "h2l"){
        arr.sort((a, b) => b.price - a.price);
    }
    else if(price.value == "" && price.value ==""){
        displayData(cars);
    }

    displayData(arr);
}

function handleSingle(car){
    localStorage.removeItem("single");
    localStorage.setItem("single",JSON.stringify(car));
    window.location.href='./single-card.html';
}

function handleBook(car){
    let userLog=JSON.parse(localStorage.getItem("userLog"));
    if(userLog){
        localStorage.removeItem("car");
        localStorage.setItem("car",JSON.stringify(car));
        window.location.href='./checkout.html';
    }else{
        window.location.href='./login.html';
    }
}

//Local storage Update
let historyData = JSON.parse(localStorage.getItem("history")) || [];
let userLog = JSON.parse(localStorage.getItem("userLog")) || [];

if(userLog?.email?.length!=0) {
    let currentDate = new Date();
    let day = currentDate.getDate();
    let month = currentDate.getMonth() + 1;
    let year = currentDate.getFullYear();

    let userHistory = historyData.filter(entry => {
        let date=entry.bookingDate.split("-");
        return entry.email === userLog.email && (year<date[2] || month<date[1] || day<=date[0]) && entry.status!="cancel" && entry.status!="completed";
    });
    localStorage.setItem("user-booking", JSON.stringify(userHistory));
}

//Badge update
let userBooking=JSON.parse(localStorage.getItem("user-booking")) || [];
let bookCount=document.getElementById("book-count");
bookCount.innerText="";
bookCount.innerText=userBooking.length;

//UserLog
if(userLog && userLog.length!=0){
    let nameEle = document.getElementById("name");
    nameEle.textContent=userLog.name.toUpperCase();
    nameEle.removeAttribute("href");

    let logEle = document.getElementById("log");
    logEle.removeAttribute("href");
    logEle.textContent = "Logout";

    logEle.addEventListener("click",function(){
        localStorage.removeItem("userLog");
        location.location = "../index.html";
    });
}

//Search bar nav
let searchInput = document.getElementById("search-input");
let searchIcon = document.getElementById("search-icon");
let searchResult = document.getElementById("search-result");

searchInput.addEventListener("input", () => {
    const query = searchInput.value;
    if(query.length==0){
        searchResult.style.display="none";
    }else{
        searchResult.style.display="block";
    }
    const results = filterLocations(query);
    searchInput.style.display="block";
    displayResults(results);
});

searchIcon.addEventListener("click", () => {
    const query = searchInput.value;
    const results = filterLocations(query);
    searchInput.style.display="block";  
    displayResults(results);
});

function filterLocations(query) {
    return locations.filter(location => location.name.toLowerCase().includes(query.toLowerCase()));
}

function displayResults(results) {
    searchResult.innerHTML = "";
    if(results.length == 0) {
        searchResult.innerHTML = "<p>No results found</p>";
    }
    results.forEach(location => {
        let div=document.createElement("div");
        div.className="outer";
        div.innerHTML=`
            <div class="inner-img">
                <img src="${location.image}">
            </div>
            <div class="inner-text">
                <p><span>Name:</span> ${location.name}</p>
                <p><span>Distance:</span> ${location.distance}</p>
            </div>
        `;

        div.addEventListener("click",()=>handleSearch(location));

        searchResult.appendChild(div);
    });
}

function handleSearch(location){
    let userLog=JSON.parse(localStorage.getItem("userLog"));
    if(userLog){
        localStorage.removeItem("location");
        localStorage.setItem("location",JSON.stringify(location));
        window.location.href='./cars-card.html';
    }
    else{
        window.location.href='./login.html';
    }
}

//form
let date=document.getElementById("book-date");
let days=document.getElementById("book-number");
let submit=document.getElementById("sub");

submit.addEventListener("click",submitHandle);

function submitHandle(e){
    e.preventDefault();
    if(date.value.length==0){
        showAlert("ALERT: Enter date of booking","red");
    }
    else if(!/^\d{1,2}-\d{1,2}-\d{4}$/.test(date.value)){
        showAlert("ALERT: Enter date properly (DD-MM-YYYY)","red");
    }
    else if(days.value.length==0){
        showAlert("ALERT: Enter number of days for booking","red");
    }
    else if(days.value>5){
        showAlert("ALERT: You can book only uptp 5 days","red");
    }
    else{
        loadData(date.value,days.value);
    }
}

function showAlert(message,color){
    let alertDiv= document.getElementById("alert");
    let alertMsg=document.createElement("p");
    alertMsg.style.color=color;
    alertMsg.innerText=message;
    alertDiv.appendChild(alertMsg);
    setTimeout(()=>{
        alertDiv.removeChild(alertMsg);
    },2000);
}

function loadData(date,days){
    let obj={
        date:date,
        days:days
    }

    localStorage.setItem("settingDates",JSON.stringify(obj));
    window.location = "#mid-section-1"
}

//admin log
let adminLog = JSON.parse(localStorage.getItem("adminLog"));

let admin = document.getElementById("admin");
admin.addEventListener("click",handleAdmin);

function handleAdmin(){
    if(adminLog && adminLog.length != 0){
        window.location.href="./admin-dashboard.html"
    }
    else{
        window.location.href="./admin-login.html"
    }   
}

//Burgur
let burgur=document.querySelector(".burgur");
let x=document.querySelector(".x");
let navDrop=document.querySelector(".nav-dropdown");

burgur.addEventListener("click",handleBurgur);
x.addEventListener("click",handleX);

function handleBurgur(){
    x.style.display="block";
    navDrop.style.display="block";
    burgur.style.display="none";
}

function handleX(){
    x.style.display="none";
    navDrop.style.display="none";
    burgur.style.display="block";
}